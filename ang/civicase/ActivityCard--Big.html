<div class="civicase__activity-card civicase__activity-card--big" ng-class="{'civicase__activity-card--big--milestone' :activity.category.indexOf('milestone') > -1}">
  <div class="panel panel-default">
    <div class="panel-body">
      <div ng-if="activity.icon || activity.category.indexOf('task') > -1 || activity.category.indexOf('milestone') > -1" class="civicase__activity-card-left">
        <span ng-if="activity.icon || activity.category.indexOf('milestone') > -1" activity-icon="activity"></span>
        <!-- Task - Checkbox -->
        <div
          ng-if="activity.category.indexOf('task') > -1"
          class="civicase__checkbox"
          title="{{ activity.is_completed ? ts('Mark incomplete') : ts('Mark complete') }}"
          ng-click="markCompleted(activity); $event.stopPropagation();" role="checkbox" aria-checked="{{activity.is_completed}}" tabindex="0" aria-labelledby="Mark complete/incomplete">
          <i ng-if="activity.is_completed" class="civicase__checkbox--checked material-icons">check_box</i>
        </div>
        <!-- End - Task - Checkbox -->
      </div>
      <!-- Activity Body -->
      <div ng-if="activity" class="civicase__activity-card-inner" ng-click="viewInPopup($event, activity)">
        <!-- Top section -->
        <div class="civicase__activity-card-row">
            <span class="civicase__activity-type" ng-class="{'civicase__activity-type--completed': (activity.category.indexOf('task') > -1 && activity.is_completed)}">{{ activity.type }}</span>
          <!-- Attachments to show for milestones-->
          <div class="btn-group civicase__activity-attachment__container" ng-if="activity.file_id && activity.category.indexOf('milestone') > -1">
            <i ng-mouseover="getAttachments(activity)" class="civicase__activity-attachment__icon material-icons">attach_file</i>
            <ul class="dropdown-menu">
              <li ng-if="!activity.attachments || !activity.attachments.length" class="civicase__activity-attachment-load">
                <span>
                  <i class="civicase__activity-attachment-load-icon text-primary material-icons">loop</i> &nbsp;{{ ts('Loading...') }}
                </span>
              </li>
              <li ng-repeat="file in activity.attachments || []">
                <a class="civicase__activity-attachment__file-name"
                  title="{{ file.description || ts('Download File') }}"
                  href="{{ file.url }}">
                  <i class="civicase__activity-attachment__file-icon crm-i {{ file.icon }}"></i> &nbsp;{{ file.name }}
                </a>
              </li>
              <li ng-if="activity.attachments.length" role="separator" class="divider"></li>
              <li ng-if="activity.attachments.length">
                <a class="civicase__activity-attachment__file-name"
                  ng-href="{{ 'civicrm/case/activity/download-all-files' | civicaseCrmUrl:{ activity_id: activity.id } }}">
                  <i class="civicase__activity-attachment__file-icon crm-i fa-download"></i> &nbsp;Download all
                </a>
              </li>
            </ul>
          </div>
          <!-- End - Attachments -->
          <!-- Stars to show for Milestons -->
          <a ng-click="toggleActivityStar($event, activity)" href ng-if="activity.is_star && activity.category.indexOf('milestone') > -1" title="{{ activity.is_star === '0' ? ts('Add star') : ts('Unstar') }}" class="civicase__activity-star__container">
            <i ng-if="activity.is_star === '0'" class="civicase__activity-star material-icons">star_border</i>
            <i ng-if="activity.is_star === '1'" class="civicase__activity-star active material-icons">star</i>
          </a>
          <!-- End - Rating -->
          <span ng-if="activity.assignee_contact_name" contact-card avatar="true" contacts="activity.assignee_contact_name"></span>
          <div ng-include="'~/civicase/ActivityCard--Menu.html'"></div>
        </div>
        <!-- End - top section -->
        <div ng-if="activity.category.indexOf('milestone') == -1">
          <span class="civicase__activity-date" ng-class="{'civicase__overdue-activity-icon': activity.is_overdue}">{{formatDate(activity.activity_date_time, 'DD MMM YYYY') }}</span>
          <!-- Attachments to show for milestones-->
          <div class="btn-group civicase__activity-attachment__container" ng-if="activity.file_id && activity.category.indexOf('milestone') == -1">
            <i ng-mouseover="getAttachments(activity)" class="civicase__activity-attachment__icon material-icons">attach_file</i>
            <ul class="dropdown-menu">
              <li ng-if="!activity.attachments || !activity.attachments.length" class="civicase__activity-attachment-load">
                <span>
                  <i class="civicase__activity-attachment-load-icon text-primary material-icons">loop</i> &nbsp;{{ ts('Loading...') }}
                </span>
              </li>
              <li ng-repeat="file in activity.attachments || []">
                <a class="civicase__activity-attachment__file-name"
                  title="{{ file.description || ts('Download File') }}"
                  href="{{ file.url }}">
                  <i class="civicase__activity-attachment__file-icon crm-i {{ file.icon }}"></i> &nbsp;{{ file.name }}
                </a>
              </li>
              <li ng-if="activity.attachments.length" role="separator" class="divider"></li>
              <li ng-if="activity.attachments.length">
                <a class="civicase__activity-attachment__file-name"
                  ng-href="{{ 'civicrm/case/activity/download-all-files' | civicaseCrmUrl:{ activity_id: activity.id } }}">
                  <i class="civicase__activity-attachment__file-icon crm-i fa-download"></i> &nbsp;Download all
                </a>
              </li>
            </ul>
          </div>
          <!-- End - Attachments -->
          <!-- Stars to show for Milestons -->
          <a ng-click="toggleActivityStar($event, activity)" href ng-if="activity.is_star && activity.category.indexOf('milestone') == -1" title="{{ activity.is_star === '0' ? ts('Add star') : ts('Unstar') }}" class="civicase__activity-star__container">
            <i ng-if="activity.is_star === '0'" class="civicase__activity-star material-icons">star_border</i>
            <i ng-if="activity.is_star === '1'" class="civicase__activity-star active material-icons">star</i>
          </a>
        </div>
        <!-- Subject -->
        <div class="civicase__activity-subject">{{ activity.subject }}</div>
        <!-- End - Subject -->
        <!-- Tags -->
        <div class="civicase__activity__tags-container" ng-if="activity.tag_id">
          <span
            class="badge"
            title="{{ tag['tag_id.description'] }}"
            ng-repeat="tag in activity.tag_id || []"
            style="background-color: {{ tag['tag_id.color'] }};"
          >{{ tag['tag_id.name'] }}</span>
        </div>
        <!-- End - Tags -->
        <!-- With -->
        <div class="civicase__activity-card-row">
          <span class="civicase__activity-with">With:&nbsp;</span>
          <span class="civicase__contact-card" contact-card contacts="activity.target_contact_name"></span>
        </div>
        <!-- End - With -->
        <!-- Big Date -->
        <div ng-if="activity.category.indexOf('milestone') > -1" class="civicase__highlighted-date" ng-class="{'civicase__highlighted-date--overdue': activity.is_overdue}">
          <div class="civicase__highlighted-date__inner">
            <span class="civicase__highlighted-date__due-on"> Due on </span>
            <span class="civicase__highlighted-date__ddmm"> {{formatDate(activity.activity_date_time, 'DD MMM') }} </span>
            <span class="civicase__highlighted-date__yyyy"> {{formatDate(activity.activity_date_time, 'YYYY') }} </span>
          </div>
        </div>
        <!-- End Big Date -->
      </div>
      <!-- Activity Body -->

      <!-- No result behaviour -->
      <div ng-if="!activity" class="civicase__activity-card--big--empty">
        <div ng-if="type === 'milestone'" class="civicase__activity-no-result-icon civicase__activity-no-result-icon--milestone"></div>
        <div ng-if="type === 'activity'" class="civicase__activity-no-result-icon civicase__activity-no-result-icon--activity"></div>
        <div class="civicase__activity-card--big--empty-title" ng-if="type === 'milestone'"> No upcoming milestones </div>
        <div class="civicase__activity-card--big--empty-title" ng-if="type === 'activity'"> No upcoming activities </div>
        <div class="civicase__activity-card--big--empty-description" ng-if="type === 'milestone'"> Click on the button below to add a milestone to this case </div>
        <div class="civicase__activity-card--big--empty-description" ng-if="type === 'activity'"> Click the button below to add an activity </div>
        <div class="civicase__activity-card--big--empty-button btn" ng-if="type === 'milestone'"> ADD MILESTONE </div>
        <span ng-if="type === 'activity'" civicase-dropdown>
          <div class="civicase__activity-card--big--empty-button btn"
            civicase-dropdown-toggle>
            ADD ACTIVITY
          </div>
          <civicase-add-activity-menu case="case">
          </civicase-add-activity-menu>
        </span>
      </div>
      <!-- End of no result behaviour -->
    </div>
  </div>
</div>
