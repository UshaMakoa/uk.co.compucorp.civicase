
<!--  To do:
  Add
  * use 'civicase__animated-checkbox-card--expanded' class : for enabled checkbox state
  * Update links with activityFeedUrl function activityFeedUrl(caseid, activityType to link, activityStatus to Link)
  -->
<div class="panel panel-default panel-strip-primary civicase__case-card civicase__animated-checkbox-card" ng-style="{'border-left-color': data.color}" ng-class="{'civicase__case-card--active': $parent.viewingCase === data.id, 'civicase__case-card--closed': data.status === 'Resolved'}" >
  <div class="panel-body">
    <!--
      TODO: To be implemented when implementing bulk actions.
      Click event to be implemented as a part of bulk actions
     <div ng-if="!$parent.bulkAllowed" class="civicase__case-card-lock">
      <div class="civicase__case-card-lock__inner fa fa-lock"></div>
    </div> -->
    <span class="civicase__checkbox" ng-if="!$parent.viewingCase && $parent.selectedCases && $parent.bulkAllowed" role="checkbox" aria-checked="{{activity.is_completed}}" tabindex="0" aria-labelledby="Mark complete/incomplete">
      <i ng-if="data.selected" class="civicase__checkbox--checked material-icons">check_box</i>
    </span>
    <span uib-popover-template="'contact-popover.html'"
      popover-class="contact-popover-container"
      popover-placement="auto bottom-left"
      popover-trigger="'mouseenter'">
      <div contact-card class="civicase__case-card__contact" contacts="data.client"></div>
    </span>
    <div class="civicase__case-card__case-id">Case ID: {{ data.id }}</div>
    <div class="civicase__case-card__type">{{ data.case_type }}</div>
    <div class="civicase__case-card__next-milestone" ng-if="data.activity_summary.milestone.length > 0">
      <span>Next Milestone: </span>
      <a class="civicase__case-card__next-milestone-date"
         ng-class="{'civicase__overdue-activity-icon': isOverdue(data.activity_summary.milestone[0].activity_date_time)}"
         ng-href="#{{ activityFeedUrl(data.id, 'milestone', 'incomplete', data.activity_summary.milestone[0].id) }}"
         title="{{data.activity_summary.milestone[0].subject || data.activity_summary.milestone[0].type;}}"
      >{{ formatDate(data.activity_summary.milestone[0].activity_date_time) }} </a>
    </div>
    <div class="civicase__case-card__activity-info">
      <div class="civicase__case-card__activity-count-container">
        <span>Tasks: </span>
        <a class="civicase__case-card__activity-count"
           ng-if="data.category_count.incomplete.task"
           ng-href="#{{ activityFeedUrl(data.id, 'task', 'incomplete') }}"
        > {{ data.category_count.incomplete.task }} </a>
        <span ng-if="data.category_count.incomplete.task && data.category_count.overdue.task" class="civicase__pipe"> | </span>
        <a class="civicase__case-card__activity-count civicase__overdue-activity-icon civicase__overdue-activity-icon--count"
           ng-if="data.category_count.overdue.task"
           ng-href="#{{ activityFeedUrl(data.id, 'task', 'incomplete') }}"
        > {{ data.category_count.overdue.task }} </a>
        <span ng-if="!data.category_count.incomplete.task && !data.category_count.overdue.task" class="civicase__case-card__activity-count civicase__case-card__activity-count--zero">0</span>
      </div>
      <div class="civicase__case-card__activity-count-container">
        <span>Comms: </span>
        <a class="civicase__case-card__activity-count"
           ng-if="data.category_count.incomplete.communication"
           ng-href="#{{ activityFeedUrl(data.id, 'communication', 'incomplete') }}"
        > {{ data.category_count.incomplete.communication }} </a>
        <span ng-if="data.category_count.incomplete.communication && data.category_count.overdue.communication" class="civicase__pipe"> | </span>
        <a class="civicase__case-card__activity-count civicase__overdue-activity-icon civicase__overdue-activity-icon--count"
           ng-if="data.category_count.overdue.communication"
           ng-href="#{{ activityFeedUrl(data.id, 'communication', 'incomplete') }}"
        > {{ data.category_count.overdue.communication }} </a>
        <span ng-if="!data.category_count.incomplete.communication && !data.category_count.overdue.communication" class="civicase__case-card__activity-count civicase__case-card__activity-count--zero">0</span>
      </div>
      <div class="civicase__case-card__activity-count-container">
        <span>Other: </span>
        <a class="civicase__case-card__activity-count"
           ng-if="data.category_count.incomplete.other"
           ng-href="#{{ activityFeedUrl(data.id, null, 'incomplete') }}"
        > {{ data.category_count.incomplete.other }} </a>
        <span ng-if="data.category_count.incomplete.other && data.category_count.overdue.other" class="civicase__pipe"> | </span>
        <a class="civicase__case-card__activity-count civicase__overdue-activity-icon civicase__overdue-activity-icon--count"
           ng-if="data.category_count.overdue.other"
           ng-href="#{{ activityFeedUrl(data.id, null, 'incomplete') }}"
        > {{ data.category_count.overdue.other }} </a>
        <span ng-if="!data.category_count.incomplete.other && !data.category_count.overdue.other" class="civicase__case-card__activity-count civicase__case-card__activity-count--zero">0</span>
      </div>
    </div>
    <div class="civicase__case-card__tags-container" ng-if="data.tag_id">
      <span
        class="civicase__case-card__tag badge"
        title="{{ tag['tag_id.description'] }}"
        ng-repeat="tag in data.tag_id || []"
        ng-class="{'text-dark': CRM.utils.colorContrast(tag['tag_id.color'] || '#cccccc') === 'black'}"
        style="background-color: {{ tag['tag_id.color'] }};"
      >{{ tag['tag_id.name'] }}</span>
    </div>
  </div>
</div>

<script type="text/ng-template" id="contact-popover.html">
  <div class="civicase__contact-popover">
    <div class="col-xs-12">
      <h2>John Smith</h2>
      <hr />
    </div>
    <div class="col-xs-6">
      <div class="row">
        <div class="civicase__contact-popover__detail">
          <div class="col-sm-5"><strong>Home Phone</strong></div>
          <div class="col-sm-7">09382 278 372</div>
        </div>
        <div class="civicase__contact-popover__detail">
          <div class="col-sm-5"><strong>Home Mobile</strong></div>
          <div class="col-sm-7"></div>
        </div>
        <div class="civicase__contact-popover__detail">
          <div class="col-sm-5"><strong>Primary Address</strong></div>
          <div class="col-sm-7">251 Maple Lane</div>
        </div>
        <div class="civicase__contact-popover__detail">
          <div class="col-sm-5"><strong>City</strong></div>
          <div class="col-sm-7">Kinney</div>
        </div>
        <div class="civicase__contact-popover__detail">
          <div class="col-sm-5"><strong>State</strong></div>
          <div class="col-sm-7">MN</div>
        </div>
        <div class="civicase__contact-popover__detail">
          <div class="col-sm-5"><strong>Postal Code</strong></div>
          <div class="col-sm-7">37281</div>
        </div>
      </div>
    </div>
    <div class="col-xs-6">
      <div class="row">
        <div class="civicase__contact-popover__detail">
          <div class="col-sm-5"><strong>Primary Email</strong></div>
          <div class="col-sm-7">m.chambers@thisisanemail.comm.chambers@thisisanemail.com</div>
        </div>
        <div class="civicase__contact-popover__detail">
          <div class="col-sm-5"><strong>Groups</strong></div>
          <div class="col-sm-7">Summer Program</div>
        </div>
        <div class="civicase__contact-popover__detail">
          <div class="col-sm-5"><strong>Tags</strong></div>
          <div class="col-sm-7">Lorem</div>
        </div>
        <div class="civicase__contact-popover__detail">
          <div class="col-sm-5"><strong>Gender</strong></div>
          <div class="col-sm-7">Female</div>
        </div>
        <div class="civicase__contact-popover__detail">
          <div class="col-sm-5"><strong>Date of Birth</strong></div>
          <div class="col-sm-7">September 9th, 1968</div>
        </div>
      </div>
    </div>
  </div>
</script>
